<!DOCTYPE html>
<html>
    <head>
        <link href="https://cwelth.com/gfx/summer-icon.png" rel="icon"/>
        <link href="/zig/font.css" rel="stylesheet" type="text/css"/>
        <link href="/zig/style.css" rel="stylesheet" type="text/css"/>
        <meta property="og:title" content="Урок #4"/>
        <meta property="vk:image"  content="https://dmitriy-407.github.io/zig/img/4.png"/>
        <meta charset="utf-8">
        <title>Руководство по моддингу</title>
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript">
            google.load("jquery", "1.3.2");
            google.load("jqueryui", "1.7.2");
        </script>
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <div class="content">
            <a href="/zig/">
                <div class="forg">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Ebene_1" x="0px" y="0px" width="100%" height="100%" viewBox="0 0 316 66.7" style="enable-background:new 0 0 316 66.7;" xml:space="preserve">
                    <style type="text/css">
                        .st0{fill:#DFA86A;}
                        .st1{fill:#26303d;}
                    </style>
                    <g>
                        <g>
                            <polygon class="st0" points="114.1,55.6 125,55.6 125,38.7 143,38.7 143,28.4 125,28.4 125,21.4 144.1,21.4 144.1,11.1     114.1,11.1   "/>
                            <path class="st0" d="M185.3,16.3c-2.1-2.1-4.6-3.6-7.5-4.7c-2.7-1-5.8-1.5-9-1.5l-0.4,0c-3.4,0-6.5,0.6-9.3,1.7    c-2.9,1.1-5.4,2.7-7.4,4.8c-2.1,2.1-3.7,4.6-4.9,7.5c-1.2,2.9-1.7,6.1-1.7,9.6c0,3.4,0.6,6.6,1.8,9.4c1.2,2.8,2.8,5.3,4.9,7.3    c2.1,2,4.6,3.6,7.4,4.7c2.8,1.1,6,1.7,9.3,1.7h0h0c3.4,0,6.6-0.6,9.4-1.8c2.9-1.1,5.4-2.8,7.5-4.8c2.1-2,3.7-4.5,4.9-7.4    c1.2-2.8,1.8-6,1.8-9.4c0-3.5-0.6-6.7-1.7-9.6C189,20.9,187.3,18.4,185.3,16.3z M180.6,33.1c0,2-0.3,3.8-0.9,5.4    c-0.6,1.6-1.4,3-2.5,4.2c-1,1.1-2.3,2.1-3.8,2.7c-1.5,0.7-3.2,1-5,1c-1.8,0-3.5-0.3-5-1c-1.5-0.7-2.7-1.6-3.8-2.7    c-1.1-1.2-1.9-2.6-2.5-4.2c-0.6-1.6-0.9-3.5-0.9-5.4c0-1.8,0.3-3.5,0.9-5c0.6-1.5,1.4-2.9,2.5-4c1-1.1,2.3-2,3.8-2.7    c1.5-0.6,3.1-1,5-1c1.8,0,3.5,0.3,5,1c1.5,0.6,2.8,1.5,3.8,2.7c1.1,1.1,1.9,2.5,2.5,4C180.3,29.6,180.6,31.3,180.6,33.1z"/>
                            <path class="st0" d="M224.2,33.3c1.9-2.3,2.9-5.2,2.9-8.6c0-2.6-0.5-4.8-1.5-6.6c-1-1.8-2.4-3.2-4-4.2c-1.6-1-3.4-1.7-5.5-2.1    c-1.9-0.4-4-0.6-6-0.6h-16v44.5h11V38.3h2.3l9.4,17.3h13.1l-11.2-18.6C220.9,36.2,222.8,35,224.2,33.3z M204.9,21h4.4    c0.8,0,1.7,0.1,2.6,0.2c0.8,0.1,1.5,0.3,2.1,0.6c0.5,0.2,0.9,0.6,1.2,1c0.3,0.4,0.4,1,0.4,1.8c0,0.9-0.2,1.6-0.5,2.1    c-0.3,0.5-0.8,0.8-1.3,1c-0.7,0.3-1.5,0.5-2.3,0.6c-1,0.1-2,0.1-2.9,0.1h-3.8V21z"/>
                            <path class="st0" d="M242.7,24c1-1.1,2.3-2,3.8-2.7c1.5-0.6,3.1-1,5-1c1.8,0,3.6,0.3,5.3,0.9c1.6,0.6,3,1.4,4.1,2.5l1.3,1.3l8-8.1    l-1.5-1.3c-2.4-2.1-5.1-3.6-8.1-4.4c-2.9-0.8-6-1.2-9.2-1.2c-3.4,0-6.5,0.6-9.3,1.7c-2.9,1.1-5.4,2.7-7.4,4.8    c-2.1,2.1-3.7,4.6-4.9,7.5c-1.2,2.9-1.7,6.1-1.7,9.6c0,3.4,0.6,6.6,1.8,9.4c1.2,2.8,2.8,5.3,4.9,7.3c2.1,2,4.6,3.6,7.4,4.7    c2.8,1.1,6,1.7,9.3,1.7c6.5,0,12.5-1.4,17.8-4.3l1-0.5V28h-19.3v10.3h8.4V45c-0.9,0.4-1.8,0.7-2.9,0.9c-1.5,0.3-3.1,0.5-4.8,0.5    c-1.8,0-3.5-0.3-5-1c-1.5-0.7-2.7-1.6-3.8-2.7c-1.1-1.2-1.9-2.6-2.5-4.2c-0.6-1.6-0.9-3.5-0.9-5.4c0-1.8,0.3-3.5,0.9-5    C240.9,26.5,241.7,25.1,242.7,24z"/>
                            <polygon class="st0" points="285.6,45.3 285.6,38 304.3,38 304.3,27.7 285.6,27.7 285.6,21.4 305.4,21.4 305.4,11.1 274.6,11.1     274.6,55.6 306.4,55.6 306.4,45.3   "/>
                        </g>
                        <path class="st1" d="M91.6,16.7l-37.8-1.9l46.2,0v-3.7H47.8l0,7.8v6.2c0,0.1-1.5-9.1-1.9-11.7h-4.1v6.8v6.2   c0,0.1-1.8-10.9-1.9-12.3c-10.4,0-27.9,0-27.9,0c1.9,1.6,12.4,10.6,19.9,14.3c3.7,1.8,8.3,1.9,12.4,2c2.1,0.1,4.2,0.2,5.8,1.8   c2.3,2.2,2.8,5.7,0.8,8.3c-1.9,2.6-7.3,3.2-7.3,3.2L39,49.1v6.4h10.3l0.3-6.3l8.9-6.3c-0.9,0.8-3.1,2.8-6.2,7.7   c-0.7,1.1-1.3,2.3-1.7,3.5c2.2-1.9,6.8-3.2,12.2-3.2c5.3,0,9.9,1.3,12.1,3.2c-0.4-1.2-1-2.4-1.7-3.5c-3.2-4.9-5.3-6.9-6.2-7.7   l8.9,6.3l0.3,6.3h9.6v-6.4l-4.5-5.5c0,0-6.7-0.4-8.4-3.2C67.7,32.6,74.8,20.4,91.6,16.7z"/>
                    </g>
                    </svg>
                </div>
                <h1>Руководство по моддингу</h1>
            </a>
            <div class="body--content">
                <div class="lesson-header">
                    <p class="img" style="background-image: url(https://www.minecraft.net/etc.clientlibs/minecraft/clientlibs/main/resources/img/menu/menu-buy.svg)"></p>
                    <h1>Урок #4</h1>
                </div>
                <h4>И здравствуйте, уважаемые</h4>
                <p>С вами ZigTheHedge и у меня появилась пара минут, чтобы написать четвертый урок. В прошлой статье мы с вами создали три блока, которые должны иметь разный функционал. <b>Руда</b> — генерироваться, <b>блок с замочком</b> — открываться ключом, а <b>строительный блок</b>… Эээ… Он просто строительный блок</p>
                <p>В сегодняшней статье мы заставим нашу руду генерироваться в мире, добавим еще один предмет, который будет представлять из себя слиток <b>Редонита</b>. Чтобы получить этот предмет, мы <b>добавим рецепт для пережарки нашей руды в печке</b>. Кроме того, мы <b>добавим рецепт крафта</b>, который из этих слитков Редонита будет делать ключ (который мы сотворили во второй статье), и, наконец, добавим возможность при помощи ключа «открывать» наш блок с замочной скважиной. И, если он «открыт», он будет выдавать редстоун сигнал. Вроде бы, на статью информации хватит. <b>Поехали!</b></p>
                <p>Начнем, пожалуй, с генерации нашей руды в мире</p>
                <p>Думаю, будет нелишним создать отдельный пакет для классов, которые будут отвечать за генерацию нашей руды. Назовем этот пакет <b>«worldgen»</b></p>
                <p>Внутри этого пакета, создадим класс, который будет имплементировать интерфейс <b>IWorldGenerator</b>, и называться <b>«RedoniteGenerator»</b>. Сразу же после создания, не забудьте нажать <b>Alt+Enter</b> на строке декларации класса, чтобы <b>IDEA</b> предложила создать необходимые интерфейсом методы:</p>
                <div class="code">
                    <span class="color--orang">package</span> ru.zigthehedge.tutorial.worldgen<span class="color--orang">;</span><br>
                    <span class="color--orang">import</span> net.minecraft.world.World<span class="color--orang">;</span><br>
                    <span class="color--orang">import</span> net.minecraft.world.chunk.IChunkProvider<span class="color--orang">;</span><br>
                    <span class="color--orang">import</span> net.minecraft.world.gen.IChunkGenerator<span class="color--orang">;</span><br>
                    <span class="color--orang">import</span> net.minecraftforge.fml.common.IWorldGenerator<span class="color--orang">;</span><br>
                    <span class="color--orang">import</span> java.util.Random<span class="color--orang">;</span><br>
                    <br>
                    <span class="color--orang">public class</span> RedoniteGenerator <span class="color--orang">implements</span> IWorldGenerator {<br>
                        <div>
                        <span class="color--yellow">@Override</span><br>
                        <span class="color--orang">public void</span> <span class="color--orang--2">generate</span>(Random random<span class="color--orang">, int</span> chunkX<span class="color--orang">, int</span> chunkZ<span class="color--orang">,</span> World world<span class="color--orang">,</span> IChunkGenerator chunkGenerator<span class="color--orang">,</span> IChunkProvider chunkProvider) {<br>

                        }<br>
                        </div>
                    }
                </div>
                <p>А метод — один единственный и называется <b>«generate»</b>. Он будет вызываться каждый раз, когда майнкрафт захочет сгенерировать что-либо в существующем мире</p>
                <p class="warn">Эта же механика используется для генерации в принципе. То-есть, с его помощью, мы можем не только руду генерировать, но и структуры. Но о генерации структур мы будем говорить как-нибудь потом</p>
                <p class="info">Итак. Метод <b>generate</b> будет вызываться каждый раз, когда майнкрафт генерирует новый чанк, но уже <b>после того, как в чанке сгенерировались блоки</b>. За генерацию самих чанков отвечает другой интерфейс и другая механика. Зато, когда майнкрафт вызовет наш метод, мы получим данные о координатах чанка, и даже сможем получить всю информацию о блоках, из которых состоит этот чанк. Основной принцип генерации следующий: производить генерацию нужно только с определенным шансом, во всех остальных случаях - просто пропустить генерацию. Иначе, так можно и весь чанк рудой <b>«засеять»</b>…</p>
                <p>Учитывая, что мы думаем наперед, давайте создадим еще один метод, который будет проводить генерацию по заданным нами условиям. Мы сможем определить, например, количество попыток генерации, задать нужную высоту, и указать блок, вместо которого будет появляться наша руда. Нужен этот метод для того, чтобы, скажем, генерировать руду в разных измерениях с разными условиями. Нашу руду мы будем генерировать только в овере, однако, метод сам по себе является универсальным — только параметры меняй и <b>«готово»</b>!</p>
                <p class="warn">Класс <b>Predicate</b> имеет несколько источников. Нам нужен тот, который пришел из библиотеки <b>com.google.common.base</b>! Не попадитесь на это, когда будете импортировать пакеты!</p>
                <div class="code">
                    ...<br>
                    <span class="color--orang">public void</span> runGenerator(IBlockState blockToGen<span class="color--orang">, int</span> blockAmount<span class="color--orang">, int</span> chancesToSpawn<span class="color--orang">, int</span> minHeight<span class="color--orang">, int</span> maxHeight<span class="color--orang">,</span> Predicate&lt;IBlockState&gt; blockToReplace<span class="color--orang">,</span> World world<span class="color--orang">,</span> Random rand<span class="color--orang">,</span> int chunk_X<span class="color--orang">,</span> int chunk_Z)<br>
                    {<br>
                        <div>
                        <span class="color--orang">if</span> (minHeight &lt; <span class="color--blue">0</span> || maxHeight &gt; <span class="color--blue">256</span> || minHeight &gt; maxHeight) <span class="color--orang">return;</span><br>
                        WorldGenMinable generator = <span class="color--orang">new</span> WorldGenMinable(blockToGen<span class="color--orang">,</span> blockAmount<span class="color--orang">,</span> blockToReplace)<span class="color--orang">;</span><br>
                        <span class="color--orang">int</span> heightdiff = maxHeight - minHeight +<span class="color--blue">1</span><span class="color--orang">;</span><br>
                        <span class="color--orang">for</span> (<span class="color--orang">int</span> i = <span class="color--blue">0</span><span class="color--orang">;</span> i &lt; chancesToSpawn<span class="color--orang">;</span> i++){<br>
                            <div>
                            <span class="color--orang">int</span> x = chunk_X * <span class="color--blue">16</span> + rand.nextInt(<span class="color--blue">16</span>)<span class="color--orang">;</span><br>
                            <span class="color--orang">int</span> y = minHeight + rand.nextInt(heightdiff)<span class="color--orang">;</span><br>
                            <span class="color--orang">int</span> z = chunk_Z * <span class="color--blue">16</span> + rand.nextInt(<span class="color--blue">16</span>)<span class="color--orang">;</span><br>
                            generator.generate(world<span class="color--orang">,</span> rand<span class="color--orang">, new</span> BlockPos(x<span class="color--orang">,</span> y<span class="color--orang">,</span> z))<span class="color--orang">;</span><br>
                            </div>
                        }
                        </div>
                    }<br>
                    ...
                </div>
                <div class="info">
                    <p>Уууу… Сколько всего! Давайте разберемся: наш метод получает на входе следующие параметры:</p>
                    <ul>
                        <li><b style="color: #8BCD5D;">blockToGen</b> — это, собственно, блок, который будет генерироваться</li>
                        <li><b style="color: #8BCD5D;">blockAmount</b> — количество блоков в «жиле»</li>
                        <li><b style="color: #8BCD5D;">chancesToSpawn</b> — количество попыток сгенерировать блок <span style="color: #ccc;">(чем больше попыток — тем чаще наша руда будет появляться в мире)</span></li>
                        <li><b style="color: #8BCD5D;">minHeight</b><b>,</b> <b style="color: #8BCD5D;">maxHeight</b> — минимальная и максимальная высота для генерации</li>
                        <li><b style="color: #8BCD5D;">blockToReplace</b> — предикат, который будет определять, подходит ли блок по заданным координатам для замены на нашу руду</li>
                        <li><b style="color: #8BCD5D;">world</b> — измерение, где мы производим генерацию</li>
                        <li><b style="color: #8BCD5D;">rand</b> — генератор произвольных чисел <span style="color: #ccc;">(для соблюдения сида мира)</span></li>
                        <li><b style="color: #8BCD5D;">chunk_X</b><b>,</b> <b style="color: #8BCD5D;">chunk_Z</b> — координаты чанка, который сейчас генерируется</li>
                    </ul>
                    <p>Теперь тело метода: сначала мы проверим, не налажали ли мы с высотами. Высота не может быть меньше нуля, или больше 256. Кроме того, минимальная высота не может быть больше максимальной. Если хотя бы одно из этого нарушено — прекращаем генерацию</p>
                    <p class="warn">Было бы неплохо сообщить где-нибудь в консоли о том, что произошла ошибка, но мне — лень</p>
                    <p>Затем, мы создаем экземпляр класса <b>WorldGenMinable</b>, который как раз занимается тем, что умеет генерировать руды. В конструктор передаем, какой блок надо сгенерировать, в каком количестве, и вместо какого блока</p>
                    <p>Дальше мы вычисляем разницу в высотах. Она нужна для взятия произвольного значения по <b>Y</b> согласно переданным параметрам высоты</p>
                    <p>А дальше мы тупо запускаем цикл то количество раз, которое указали в <b>chancesToSpawn</b>! Вот так все просто и банально <b>:)</b></p>
                    <p>Внутри цикла мы выбираем произвольные координаты внутри чанка и запускаем-таки генератор, передавая в него мир, генератор произвольных чисел, и позицию, на которой надо попробовать сгенерировать нашу жилу руд.</p>
                </div>
                <p>Осталось только зарегистрировать наш генератор и все! Делается это при фазе <b>«Init»</b>. Регистрировать генератор нужно, по понятным причинам, на стороне сервера. Где у нас это делается? Правильно — в <b>CommonProxy</b>:</p>
                <div class="code">
                    ...<br>
                    <span class="color--orang">public void</span> <span class="color--orang--2">init</span>(FMLInitializationEvent e)<br>
                    {<br>
                        <div>GameRegistry.registerWorldGenerator(<span class="color--orang">new</span> RedoniteGenerator()<span class="color--orang">,</span> <span class="color--blue">0</span>)<span class="color--orang">;</span></div>
                    }<br>
                    ...
                </div>
                <p class="info">В методе-обработчике события <b>FMLInitializationEvent</b>, добавим в игровой регистр наш генератор. У метода <b>registerWorldGenerator</b> есть два входных параметра: экземпляр класса-генератора и <b>«вес»</b>. Почему второй параметр назван «весом» остается загадкой, так как он отвечает за позицию в очереди генерации. <b>0</b> означает, что наша руда должна генерироваться первой. Этот параметр для генератора руд не сильно важен, если только ваш мод не построен таким образом, чтобы генерация заменяла уже существующие руды. Например, если мы хотим, чтобы наша руда генерировалась вместо, скажем, железа, то очередь придется отодвинуть подальше, чтобы наш генератор запускался по очереди <b>после</b> генератора жил железной руды</p>
                <p>После всего этого, нам нужно не забыть одну важную вещь: мы написали свой метод для генерации, но забыли его вызвать! Срочно бежим в <b>RedoniteGenerator</b>!</p>
                <div class="code">
                    ...<br>
                    <span class="color--yellow">@Override</span><br>
                    <span class="color--orang">public void</span> generate(Random random<span class="color--orang">, int</span> chunkX<span class="color--orang">, int</span> chunkZ<span class="color--orang">,</span> World world<span class="color--orang">,</span> IChunkGenerator chunkGenerator<span class="color--orang">,</span> IChunkProvider chunkProvider) {<br>
                        <div>
                            if(world.<span class="color--violet">provider</span>.getDimension() == <span class="color--blue">0</span>)<br>
                            <div>runGenerator(TutorialBlocks.<span class="color--violet">redoniteOre</span>.getDefaultState()<span class="color--orang">,</span> <span class="color--blue">10</span><span class="color--orang">,</span> <span class="color--blue">20</span><span class="color--orang">,</span> <span class="color--blue">20</span><span class="color--orang">,</span> <span class="color--blue">70</span><span class="color--orang">,</span> BlockStateMatcher.forBlock(Blocks.<span class="color--violet">STONE</span>)<span class="color--orang">,</span> world<span class="color--orang">,</span> random<span class="color--orang">,</span> chunkX<span class="color--orang">,</span> chunkZ)<span class="color--orang">;</span></div>
                        </div>
                    }<br>
                    ...
                </div>
                <div class="info">
                    <p>Сначала мы проверяем, что пытаемся генерировать руды в овере <span style="color: #ccc;">(для этого можно запросить <b>getDimension</b> у провайдера мира)</span> <b>0</b> — это овер <span style="color: #ccc;">(<b>-1</b> — это незер, <b>1</b> — это энд)</span></p>
                    <p>Если мы все же в овере, то запускаем наш генератор. Я выбрал следующие параметры:</p>
                    <ul>
                        <li>Генерируем блок <b>redoniteOre</b> в его <b>«состоянии по-умолчанию»</b></li>
                        <li>Размер <b>«жилы»</b> — 10 блоков</li>
                        <li>Количество попыток попасть в нужный блок — 20</li>
                        <li>Высота генерации — от 20 до 70</li>
                        <li>Предикат на замену блока гладкого камня</li>
                    </ul>
                </div>
                <p>И, если вы все сделали верно, то вашу руду можно будет найти под землей:</p>
                <p class="imag" style="background-image: url(https://pp.userapi.com/c854428/v854428745/a1625/DP9slCzSpuY.jpg); height: 300px;" onclick="image('https://pp.userapi.com/c854428/v854428745/a1625/DP9slCzSpuY.jpg')"></p>
                <p><b>Получилось? Отлично! Едем дальше!</b></p>
                <p>Давайте создадим предмет, который будет представлять собой слиток, получаемый из нашей руды. Я назову его <b>RedoniteIngot</b>:</p>
                <div class="code">
                    <span class="color--orang">package</span> ru.zigthehedge.tutorial.items<span class="color--orang">;</span><br>
                    <span class="color--orang">import</span> net.minecraft.client.renderer.block.model.ModelResourceLocation<span class="color--orang">;</span><br>
                    <span class="color--orang">import</span> net.minecraft.creativetab.CreativeTabs<span class="color--orang">;</span><br>
                    <span class="color--orang">import</span> net.minecraft.item.Item<span class="color--orang">;</span><br>
                    <span class="color--orang">import</span> net.minecraftforge.client.model.ModelLoader<span class="color--orang">;</span><br>
                    <span class="color--orang">import</span> net.minecraftforge.fml.relauncher.Side<span class="color--orang">;</span><br>
                    <span class="color--orang">import</span> net.minecraftforge.fml.relauncher.<span class="color--yellow">SideOnly</span><span class="color--orang">;</span><br>
                    <span class="color--orang">import</span> ru.zigthehedge.tutorial.Tutorial<span class="color--orang">;</span><br>
                    <br>
                    <span class="color--orang">public class</span> RedoniteIngot <span class="color--orang">extends</span> Item {
                        <div>
                        <span class="color--orang">public</span> <span class="color--orang--2">RedoniteIngot</span> ()<br>
                        {
                            <div>
                            setRegistryName(<span class="color--green">"redonite_ingot"</span>)<span class="color--orang">;</span><br>
                            setUnlocalizedName(Tutorial.<span class="color--violet">MODID</span> + <span class="color--green">".redonite_ingot"</span>)<span class="color--orang">;</span><br>
                            setCreativeTab(CreativeTabs.<span class="color--violet">MISC</span>)<span class="color--orang">;</span>
                            </div>
                        }<br>
                        <span class="color--yellow">@SideOnly</span>(Side.<span class="color--violet">CLIENT</span>)<br>
                        <span class="color--orang">public void</span> <span class="color--orang--2">initModel</span>() {<br>
                            <div>ModelLoader.setCustomModelResourceLocation(<span class="color--orang">this,</span> 0<span class="color--orang">, new</span> ModelResourceLocation(getRegistryName()<span class="color--orang">,</span> <span class="color--green">"inventory"</span>))<span class="color--orang">;</span></div>
                        }
                        </div>
                    }
                </div>
                <p>И, конечно же, не забуду создать экземпляр и зарегистрировать его по всем правилам, так же, как и любой другой предмет</p>
                <p>Кстати, вот вам текстура:</p>
                <div id="redonite_ingot" class="image--donwload"><p class="image--info" style="background-image: url(https://dmitriy-407.github.io/zig/download/redonite_ingot.png)"></p><a download href="https://dmitriy-407.github.io/zig/download/redonite_ingot.png">Скачать</a></div>
                <p>После того, как у вас получится создать слиток Редонита, настанет время добавить рецепт по переплавке руды в слиток. Делается это просто. В <b>init</b>-обработчике нашего <b>CommonProxy</b> сразу после регистрации генератора руд в мире, зарегистрируем и наш новый рецепт:</p>
                <div class="code">
                    ...<br>
                    <span class="color--orang">public void</span> <span class="color--orang--2">init</span>(FMLInitializationEvent e)<br>
                    {
                        <div>
                        GameRegistry.registerWorldGenerator(new RedoniteGenerator()<span class="color--orang">,</span> <span class="color--blue">0</span>)<span class="color--orang">;</span><br>
                        GameRegistry.addSmelting(<span class="color--orang">new</span> ItemStack(TutorialBlocks.<span class="color--violet">redoniteOre</span>)<span class="color--orang">, new</span> ItemStack(TutorialItems.<span class="color--violet">redoniteIngot</span>)<span class="color--orang">,</span> <span class="color--blue">100</span>)<span class="color--orang">;</span>
                        </div>
                    }<br>
                    ...
                </div>
                <p class="info">Метод <b>addSmelting</b> принимает три параметра: исходный и результативный предмет, а так же количество опыта, которое получит игрок, взяв готовый продукт из печки</p>
                <div class="warn">
                    <p>Предметы указываются в виде <b>ItemStack</b>. Это класс, описывающий стак предметов. То-есть, он позволяет определить не только тип предмета, но и его метаданные, <b>NBT</b>, количество в стаке и прочее</p>
                    <p>Давайте опишем наш рецепт: на входе — мы должны поместить блок руды. На выходе — мы должны получить слиток. Создаем два стака. В первом указываем блок нашей руды, во втором — предмет — слиток. Опустив все остальные параметы у конструктора, мы создаем стак из одного предмета в его виде <b>«по-умолчанию»</b>. То-есть, ровно то, что нам нужно для рецепта</p>
                </div>
                <p class="imag" style="background-image: url(https://pp.userapi.com/c854428/v854428745/a16aa/-P6EKBNhbgA.jpg); height: 300px;" onclick="image('https://pp.userapi.com/c854428/v854428745/a16aa/-P6EKBNhbgA.jpg')"></p>
                <p><b>Получилось? Клево!</b> Теперь давайте создадим рецепт на верстаке, который из этих слитков будет собирать нам ключ!</p>
                <p>Рецепт у нас будет следующий:</p>
                <p class="imag" style="background-image: url(https://pp.userapi.com/c854428/v854428745/a174b/DMR7S1LPOy8.jpg); height: 300px;" onclick="image('https://pp.userapi.com/c854428/v854428745/a174b/DMR7S1LPOy8.jpg')"></p>
                <p>Для начала, рецепты на верстаке работают иначе, нежели рецепты для печки. И вы не поверите, но в коде нам вообще не придется что-либо делать, чтобы добавить рецепт! Вместо этого, нам надо создать каталог внутри наших ресурсов под названием <b>«recipes»</b></p>
                <p>src/main/resources/assets/tutorial/<b>recipes</b>/</p>
                <p class="warn">В новых версиях майнкрафта, рецепты для печки так же описываются при помощи внешних <b>json</b>-файлов</p>
                <p>Внутри этого каталога, нам надо создать файл, который будет описывать рецепт ключа. Название не имеет значения, но я предпочитаю называть файлы именем предмета на выходе. То-есть, в нашем случае, назовем файл <b>key.json</b>:</p>
                <div class="code">
                    {
                    <div>
                    <span class="color--violet">"result"</span><span class="color--orang">:</span> {
                        <div><span class="color--violet">"item"</span><span class="color--orang">:</span> <span class="color--green">"tutorial:key"</span></div>
                      }<span class="color--orang">,</span><br>
                      <span class="color--violet">"pattern"</span><span class="color--orang">:</span> [
                    <div><span class="color--green">"aa "</span><span class="color--orang">,</span><br>
                        <span class="color--green">" a "</span><span class="color--orang">,</span><br>
                        <span class="color--green">"bab"</span></div>
                      ]<span class="color--orang">,</span><br>
                      <span class="color--violet">"type"</span><span class="color--orang">:</span> <span class="color--green">"forge:ore_shaped"</span><span class="color--orang">,</span><br>
                      <span class="color--violet">"key"</span><span class="color--orang">:</span> {
                        <div>
                        <span class="color--violet">"a"</span><span class="color--orang">:</span> {
                            <div><span class="color--violet">"item"</span><span class="color--orang">:</span> <span class="color--green">"tutorial:redonite_ingot"</span></div>
                      }<span class="color--orang">,</span>
                      <span class="color--violet">"b"</span><span class="color--orang">:</span> {
                          <div><span class="color--violet">"type"</span><span class="color--orang">:</span> <span class="color--green">"forge:ore_dict"</span><span class="color--orang">,</span><br>
                          <span class="color--violet">"ore"</span><span class="color--orang">:</span> <span class="color--green">"ingotGold"</span></div>
                        }
                        </div>
                      }
                    </div>
                    }
                </div>
                <p class="warn"><b>Обратите внимание, что этот «key» никак с нашем ключем не связан!</b></p>
                <div class="info">
                    <p>В файле мы определяем результат крафта. Делается это в блоке <b>«result»</b>, параметром <b>«item»</b>. Значением параметра должно являться регистровое имя предмета или блока, который получится при крафте</p>
                    <p>Следующий блок называется <b>«pattern»</b> и представляет собой буквенную схему стандартного верстака 3х3. Каждая буква означает ингредиент крафта. В нашем случае, у нас два ингредиента — стало быть мы используем две буквы</p>
                    <p>Далее следует параметр <b>«type»</b>, который описывает вид рецепта. В нашем случае — рецепт <b>«форменный»</b> <span style="color: #ccc;">(или <b>shaped</b>)</span>. Чем отличается форменный рецепт от бесформенного? В бесформенном важно только количество и тип ингредиентов и совершенно не важно, как они расположены на верстаке. В форменных же рецептах — важно еще и расположение</p>
                    <p>И, последняя группа параметров для нашего рецепта называется <b>«key»</b></p>
                    <p>Внутри этой группы мы должны рассказать майнкрафту, какая буква какой ингредиент означает. Поэтому делаем описание в виде групп с названием, как у букв в рецепте. Для буквы <b>«а»</b> мы определяем, что предмет должен быть из мода <b>tutorial</b> и иметь регистровое имя <b>redonite_ingot</b>. Ну, тут все просто. А вот для ингредиента под буквой <b>«b»</b> я приготовил <b>«сладенькое»</b>...</p>
                    <p>Вы наверняка слышали, что такое <b>«OreDictionary»</b>. Это <b>«словарь руд»</b>. И, если уж быть до конца честным, не только руд. Фактически, этот словарь используется модами для того, чтобы сделать предметы взаимозаменяемыми. То-есть, например, есть у меня мод <b>Forestry</b>. Он добавляет олово. И есть у меня <b>Industrial Craft 2</b>, который тоже добавляет олово. У этих модов есть рецепты, которые используют в качестве ингредиентов это самое олово. <b>Но!</b> Если бы ингредиенты были описаны, как у нас в первом случае, то для рецептов из Forestry подошло бы только олово из <b>Forestry</b>! Именно поэтому был придуман достаточно простой, но очень действенный выход: для предметов или блоков, которые должны быть взаимозаменяемыми, помимо регистровых имен можно указать еще и «словарное имя». Каким образом работать с <b>OreDictionary</b>, мы с вами разберем в конце статьи, а пока что — рецепты</p>
                    <p>Для нашего ингредиента под буквой <b>«b»</b>, мы укажем тип <b>«forge:ore_dict»</b>, который позволит создать рецепт, для крафта которого можно использовать любые предметы, которые совпадают по <b>«словарному имени»</b>. Чтобы указать, для какого именно, воспользуемся параметром <b>«ore»</b></p>
                </div>
                <p>Все. Наш рецепт готов. Запускаем клиент майнкрафта и проверям, что все работает. И, если вы вдруг встретите мод, который добавляет свои слитки золота, то золото из этого мода <span style="color: #ccc;">(если его автор не лентяй)</span> должно подходить к нашему рецепту</p>
                <p><b>Окей. Мы создали способ получения ключа вполне легально!</b> Теперь давайте научим наш блок с замочной скважиной «открываться» по клику ключом</p>
                <p>Откроем наш класс блока KeyHole и добавим ему еще одно свойство. Свойство будет типа <b>«да/нет»</b> <span style="color: #ccc;">(то-есть, <b>boolean</b>)</span> и называться <b>«IS_OPENED»</b>:</p>
                <div class="code">
                    ...<br>
                    <span class="color--orang">public static</span> PropertyDirection <span class="color--violet">FACING</span> = PropertyDirection.create(<span class="color--green">"facing"</span><span class="color--orang">,</span> EnumFacing.Plane.<span class="color--violet">HORIZONTAL</span>)<span class="color--orang">;</span><br>
                    <span class="color--orang">public static</span> PropertyBool <span class="color--violet">IS_OPENED</span> = PropertyBool.create(<span class="color--green">"is_opened"</span>)<span class="color--orang">;</span><br>
                    ...
                </div>
                <p>Теперь нам надо добавить новое свойство в контейнер. Поправим метод <b>createBlockState</b>:</p>
                <div class="code">
                    ...<br>
                    <span class="color--yellow">@Override</span><br>
                    <span class="color--orang">protected</span> BlockStateContainer <span class="color--orang--2">createBlockState</span>() {
                        <div><span class="color--orang">return new</span> BlockStateContainer(<span class="color--orang">this,</span> <span class="color--violet">FACING</span><span class="color--orang">,</span> <span class="color--violet">IS_OPENED</span>)<span class="color--orang">;</span></div>
                    }<br>
                    ...
                </div>
                <p>И не забыть указать значение этого свойства по-умолчанию в <b>конструкторе</b> блока:</p>
                <div class="code">
                    ...<br>
                    setDefaultState(<span class="color--violet">blockState</span>.getBaseState().withProperty(<span class="color--violet">FACING</span><span class="color--orang">,</span> EnumFacing.<span class="color--violet">NORTH</span>).withProperty(<span class="color--violet">IS_OPENED</span><span class="color--orang">, false</span>))<span class="color--orang">;</span><br>
                    ...
                </div>
                <p>Дальше, нам надо переписать методы конвертации состояния в метаданные и наоборот. Сделаем это так:</p>
                <div class="code">
                    ...<br>
                    <span class="color--yellow">@Override</span><br>
                    <span class="color--orang">public int</span> <span class="color--orang--2">getMetaFromState</span>(IBlockState state) {<br>
                        <div><span class="color--orang">return</span> state.getValue(FACING).ordinal() | (state.getValue(<span class="color--violet">IS_OPENED</span>)? <span class="color--blue">8</span> : <span class="color--blue">0</span>)<span class="color--orang">;</span></div>
                    }<br>
                    <br>
                    <span class="color--yellow">@Override</span><br>
                    <span class="color--orang">public</span> IBlockState <span class="color--orang--2">getStateFromMeta</span>(<span class="color--orang">int</span> meta) {
                        <div>return this.getDefaultState().withProperty(<span class="color--violet">FACING</span>, EnumFacing.getHorizontal(meta 	&amp; <span class="color--blue">7</span>)).withProperty(<span class="color--violet">IS_OPENED</span>, (meta 	&amp; <span class="color--blue">8</span>) &gt; <span class="color--blue">1</span>)<span class="color--orang">;</span></div>
                    }<br>
                    ...
                </div>
                <div class="info">
                    <p>В первом методе, мы прибавляем к метаданным 8, если значение нашего свойства <b>IS_OPENED</b> — истина. Почему именно <b>8</b>? Дело в том, что наше первое свойство <span style="color: #ccc;">(<b>FACING</b>)</span>, хоть и создано с фильтром на <b>«горизонтальное»</b> расположение, все равно может принимать значение от нуля до пяти в зависимости от стороны, в которую повернут блок. А это <b>3 бита</b>. Четвертый бит свободен, а восьмерка в двоичном представлении — это как раз <b>"1000"</b> — то-есть, четвертый бит. Мы устанавиливаем его в <b>«единицу»</b>, если блок <b>«открыт»</b> <span style="color: #ccc;">(значение свойства <b>IS_OPENED</b> — истина)</span>, или оставляем в нуле, если блок <b>«закрыт»</b></p>
                    <p>При преобразовании метаданных назад в состояние, мы <b>«отрезаем»</b> три бита для установки значения свойства <b>FACING</b> <span style="color: #ccc;">(делая булевую операцию <b>"И"</b>)</span>, и четвертый бит — для свойства <b>IS_OPENED</b></p>
                    <p>Зачем такие сложности? А все потому, что метаданные - это число от нуля до <b>15</b>, как я уже говорил. И, если мы с вами преобразуем <b>15</b> в двоичную систему счисления, то получится <b>«1111»</b>. Стало быть — <b>4 бита</b>. <b>Всего 4 бита</b>. Но нам нечего делать, у нас должен быть способ каким-то образом вынимать состояние наших свойств из этих <b>4 бит</b></p>
                </div>
                <p>В данный момент, наш блок никак не будет видоизменяться в зависимости от того, открыт он, или закрыт <span style="color: #ccc;">(хотя, нам ничто не мешает так сделать)</span>, однако, файл с блокстейтом блока надо подредактировать:</p>
                <div class="code">
                    {<br>
                    <div>
                      <span class="color--violet">"forge_marker"</span><span class="color--orang">:</span> 1<span class="color--orang">,</span><br>
                      <span class="color--violet">"defaults"</span><span class="color--orang">:</span> {<br>
                        <div><span class="color--violet">"model"</span>: <span class="color--green">"tutorial:keyhole"</span></div>
                      }<span class="color--orang">,</span><br>
                      <span class="color--violet">"variants"</span><span class="color--orang">:</span> {<br>
                        <div>
                        <span class="color--violet">"normal"</span><span class="color--orang">:</span> [{}]<span class="color--orang">,</span><br>
                            <span class="color--violet">"inventory"</span><span class="color--orang">:</span> [{<br>
                        <div><span class="color--violet">"transform"</span>: <span class="color--green">"forge:default-block"</span></div>
                        }]<span class="color--orang">,</span><br>
                        <span class="color--violet">"facing"</span><span class="color--orang">:</span> {<br>
                        <div><span class="color--violet">"north"</span><span class="color--orang">:</span> {}<span class="color--orang">,</span><br>
                          <span class="color--violet">"south"</span>: {<span class="color--violet">"y"</span><span class="color--orang">:</span> <span class="color--blue">180</span>}<span class="color--orang">,</span><br>
                          <span class="color--violet">"west"</span>: {<span class="color--violet">"y"</span><span class="color--orang">:</span> <span class="color--blue">270</span>}<span class="color--orang">,</span><br>
                          <span class="color--violet">"east"</span>: {<span class="color--violet">"y"</span><span class="color--orang">:</span> <span class="color--blue">90</span>}</div>
                        },<br>
                        <span class="color--violet">"is_opened"</span><span class="color--orang">:</span> {
                          <div>
                          <span class="color--violet">"true"</span><span class="color--orang">:</span> {}<span class="color--orang">,</span><br>
                          <span class="color--violet">"false"</span><span class="color--orang">:</span> {}
                          </div>
                        }
                        </div>
                      }
                    </div>
                    }
                </div>
                <p class="info">Я просто добавил еще одну секцию для свойства <b>«is_opened»</b>, и перечислил оба значения этого свойства, хотя они и ничего не делают</p>
                <p>Теперь интересное. Перегрузим для нашего блока метод <b>onBlockActivated</b>!</p>
                <div class="code">
                    ...<br>
                    <span class="color--yellow">@Override</span><br>
                    <span class="color--orang">public boolean</span> <span class="color--orang--2">onBlockActivated</span>(World worldIn<span class="color--orang">,</span> BlockPos pos<span class="color--orang">,</span> IBlockState state<span class="color--orang">,</span> EntityPlayer playerIn<span class="color--orang">,</span> EnumHand hand<span class="color--orang">,</span> EnumFacing facing<span class="color--orang">,</span> float hitX<span class="color--orang">,</span> float hitY<span class="color--orang">,</span> float hitZ) {
                        <div>
                        <span class="color--orang">if</span>(worldIn.isRemote)<span class="color--orang">return true;</span><br>
                        <span class="color--orang">if</span>(playerIn.getHeldItem(hand).getItem() == TutorialItems.<span class="color--violet">key</span>)
                        {
                            <div>
                            <span class="color--orang">if</span>(state.getValue(<span class="color--violet">IS_OPENED</span>))worldIn.setBlockState(pos<span class="color--orang">,</span> state.withProperty(<span class="color--violet">IS_OPENED</span><span class="color--orang">, false</span>)<span class="color--orang">,</span> <span class="color--blue">3</span>)<span class="color--orang">;</span><br>
                            <span class="color--orang">else</span> worldIn.setBlockState(pos, state.withProperty(<span class="color--violet">IS_OPENED</span><span class="color--orang">, true</span>)<span class="color--orang">,</span> <span class="color--blue">3</span>)<span class="color--orang">;</span>
                            </div>
                        }
                        <span class="color--orang">return true;</span>
                        </div>
                    }<br>
                    ...
                </div>
                <div class="info">
                    <p>Этот метод вызывается, когда игрок делает правый клик на нашем блоке. И сразу одна оговорка: этот метод не будет вызван, если игрок зажал <b>Shift</b> <span style="color: #ccc;">(то-есть, присел)</span> и при этом у него был предмет хотя бы в одной руке!</p>
                    <p>Во-первых, нам надо вернуть <b>true</b>, так как мы, как-никак, перегрузили обработчик события правого клика на блок, и об этом надо сообщить движку майнкрафта</p>
                    <p>Далее, нам надо проверить, что мы будем исполнять свой код на стороне сервера. Дело в том, что этот метод будет вызван и на стороне сервера и на стороне клиента <span style="color: #ccc;">(так как он никоим образом не аннотирован в суперклассе и не проходит через <b>Sided Proxy</b>)</span>, поэтому есть хитрость. В объекте <b>worldIn</b>, который передается нам в метод, есть свойство <b>isRemote</b>, которое возвращает <b>true</b>, если мы работаем с клиентской частью <b>«мира»</b>, и <b>false</b> — если с серверной. Поэтому, если мы увидели, что <b>worldIn.isRemote</b> — истина, то сразу выйдем из метода. На стороне клиента нам делать нечего</p>
                    <p>Дальше, если у нас в руке все же наш ключ <span style="color: #ccc;">(экземпляр объекта <b>TutorialItems.key</b>, я хотел сказать)</span>, то мы проверям текущее состояние блока. Если свойство <b>IS_OPENED</b> — истина, то нам придется <b>«закрыть»</b> блок, иначе — <b>«открыть»</b></p>
                </div>
                <p class="warn">Можете провести эксперимент — когда закончим с созданием функционала для этого блока, возьмите ключи в обе руки и попробуйте сделать правый клик</p>
                <div class="warn">
                    <p>Можно было обойтись одной строкой кода</p>
                    <div class="code">
                        worldIn.setBlockState(pos<span class="color--orang">,</span> state.withProperty(<span class="color--violet">IS_OPENED</span><span class="color--orang">,</span> !state.getValue(<span class="color--violet">IS_OPENED</span>))<span class="color--orang">,</span> <span class="color--blue">3</span>)<span class="color--orang">;</span>
                    </div>
                    <p>Но я решил разбить выражение на две строки, чтобы было понятнее</p>
                </div>
                <p class="info">При помощи метода <b>setBlockState</b>, мы устанавливаем новое значение состояния блока по указанной позиции. И в этот раз я использовал флаг <b>«3»</b>, а не <b>«2»</b>. Почему? Потому что нам нужно не просто поменять внешний вид блока, а еще и вызвать <b>Block Update</b>, в противном случае редстоун сигнал не будет меняться до тех пор, пока какой-нибудь другой блок не сделает принудительный <b>Block Update</b></p>
                <p>Теперь у нас получился блок, который будет реагировать, когда мы кликаем по нему правым кликом при помощи нашего ключа! Осталось немного: пусть наш блок выдает редстоун-сигнал, когда он <b>«открыт»</b>. Делается это следующим образом. Перегружаем два метода:</p>
                <div class="code">
                    ...<br>
                    <span class="color--yellow">@Override</span><br>
                    <span class="color--orang">public boolean</span> <span class="color--orang--2">canProvidePower</span>(IBlockState state) {
                        <div>
                        <span class="color--orang">return true;</span>
                        </div>
                    }<br>
                    <span class="color--yellow">@Override</span><br>
                    <span class="color--orang">public int</span> <span class="color--orang--2">getWeakPower</span>(IBlockState blockState<span class="color--orang">,</span> IBlockAccess blockAccess<span class="color--orang">,</span> BlockPos pos<span class="color--orang">,</span> EnumFacing side) {
                        <div>
                        <span class="color--orang">if</span>(blockState.getValue(<span class="color--violet">IS_OPENED</span>))
                            <div>
                            <span class="color--orang">return</span><span class="color--blue">15</span><span class="color--orang">;</span>
                            </div>
                        <span class="color--orang">else</span>
                            <div>
                            <span class="color--orang">return</span> <span class="color--blue">0</span><span class="color--orang">;</span>
                            </div>
                        </div>
                    }<br>
                    ...
                </div>
                <div class="info">
                    <p>Первый метод нужен для того, чтобы к нашему блоку <b>«присоединялась»</b> редстоун-пылька <span style="color: #ccc;">(или же провода из модов)</span>. Мы просто скажем, что <b>«да! мы можем выдавать редстоун-сигнал!»</b> в ответ на запрос майнкрафта</p>
                    <p>Второй метод будет выдавать <b>«слабый»</b> редстоун сигнал, если наш блок имеет состояние <b>IS_OPENED</b></p>
                    <p>Нужен ли нашему блоку <b>«сильный»</b> редстоун-сигнал? Не уверен, так как сильный редстоун сигнал, как правило, выдают кнопки и рычаги, потому что они могут быть привешены на сторону блока, и слабого редостун-сигнала не всегда будет достаточно. Чтобы добавить для блока выдачу <b>«сильного»</b> редстоун-сигнала, достаточно перегрузить метод <b>getStrongPower</b>, и он даже будет работать! Однако, если мы хотим пользоваться сильным редстоун-сигналом, нам надо <b>предусмотреть блок-апдейт для рядом стоящих блоков</b>. В противном случае, блоки <b>«через блок»</b> от нашего не будут знать, что наш блок начал выдавать сильный редстоун-сигнал</p>
                </div>
                <p>Надеюсь, у вас получилось вот такое:</p>
                <p class="imag" style="background-image: url(https://pp.userapi.com/c854428/v854428190/a575a/YGnlg_OpQ8o.jpg); height: 300px;" onclick="image('https://pp.userapi.com/c854428/v854428190/a575a/YGnlg_OpQ8o.jpg')"></p>
                <p>В следующей статье мы создадим специальный сундук, который можно будет открыть нашим ключом. А это значит — <b>инвентари, TileEntity, Capability,</b>и<b>GUI. Ух, будет весело!</b></p>
                <a href="https://dmitriy-407.github.io/zig/code/4/web" class="donwload">Исходники</a>
                <div class="delit">
                    <span><b>Удалена дополнительная информация</b>Из урока удалена дополнительная информация которая не являеться обязательной для ознакомления
                    <a href="https://vk.com/@zigthehedge-pishem-mody-dlya-minecraft-statya-4">Ознакомиться с удаленной информацией</a>
                    </span>
                </div>
            </div>
        </div>
        <div class="window"></div>
        <p class="up" onclick="up()"></p>
        <footer>
            <div class="content">
                <p class="avtor">Автор используемых материалов <a href="https://vk.com/zigthehedge">ZigTheHedge</a></p>
                <p class="image">Используются изображения с <a href="https://www.minecraft.net">Minecraft.net</a></p>
                <p class="dev">Разработано <a href="https://vk.com/demon_407">Dmitriy Popov</a></p>
            </div>
        </footer>
        <script src="/zig/script.js" type="text/javascript"></script>
    </body>
</html>